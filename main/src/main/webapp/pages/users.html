<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <base href="http://localhost:8080/main_war_exploded/">
  <title>AdminLTE 3 | Starter</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>
<body class="hold-transition sidebar-mini">
<div class="wrapper">
  <div class="content-wrapper">
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0">用户管理</h1>
          </div>
        </div>
      </div>
    </div>

    <div id="app">
      <el-card>
        <el-button type="primary" round @Click="handleDelete(idList)" icon="el-icon-close">批量删除</el-button>
        <el-button type="success" round @Click="handleVisible" icon="el-icon-plus">添加用户</el-button>
        <el-table
          v-loading="loading"
          :data="users"
          stripe
          style="width: 100%"
          @selection-change="handleSelectionChange"
        >
          <el-table-column
            type="selection"
            width="55">
          </el-table-column>
          <el-table-column
            type="index"
            width="50">
          </el-table-column>
          <el-table-column
            prop="username"
            label="用户名"
            width="180">
          </el-table-column>
          <el-table-column
            prop="password"
            label="密码"
            width="180">
          </el-table-column>
          <el-table-column
            prop="phone"
            label="手机">
          </el-table-column>
          <el-table-column
            prop="createTime"
            label="创建时间">
          </el-table-column>
          <el-table-column
            label="操作"
          >
            <template slot-scope="scope">
              <el-tooltip class="item" effect="dark" content="编辑" placement="top">
                <el-button type="primary" icon="el-icon-edit" circle @Click="handleVisible(scope.row)"></el-button>
              </el-tooltip>
              <el-tooltip class="item" effect="dark" content="删除" placement="top">
                <el-button type="danger" icon="el-icon-delete" circle @Click="handleDelete([scope.row.id])"></el-button>
              </el-tooltip>
            </template>
          </el-table-column>
        </el-table>

        <el-pagination
          background
          :hide-on-single-page="true"
          @size-change="handleSizeChange"
          @current-change="handleCurrentChange"
          :current-page="pageNum"
          :page-sizes="[5, 10, 20, 100]"
          :page-size="pageSize"
          layout="total, sizes, prev, pager, next, jumper"
          :total="total">
        </el-pagination>

        <el-dialog :title="title" :visible.sync="dialogFormVisible">
          <el-form v-model="form">
            <el-form-item label="用户名称">
              <el-input v-model="form.username" autocomplete="off"></el-input>
            </el-form-item>
            <el-form-item label="用户密码">
              <el-input v-model="form.password" autocomplete="off" type="password"></el-input>
            </el-form-item>
            <el-form-item label="手机号">
              <el-input v-model="form.phone" autocomplete="off"></el-input>
            </el-form-item>
          </el-form>
          <div slot="footer" class="dialog-footer">
            <el-button @click="dialogFormVisible = false">取 消</el-button>
            <el-button type="primary" @click="handleUpdate">确 定</el-button>
          </div>
        </el-dialog>
      </el-card>
    </div>
  </div>
</div>
</body>
</html>
<script src="plugins/jquery/jquery.min.js"></script>
<script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="dist/js/adminlte.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script>
  const mockUsers = [
    { id: 1, username: '洛必达', password: '123456', phone: '13770366999', createTime: '2020-05-11 20:00:00'},
    { id: 2, username: '莱布尼茨', password: '123456', phone: '13770366999', createTime: '2020-09-11 20:00:00'},
    { id: 3, username: '牛顿', password: '123456', phone: '13770366999', createTime: '2020-07-11 20:00:00'},
    { id: 4, username: '特朗普', password: '654321', phone: '13770366999', createTime: '2020-01-11 20:00:00'},
    { id: 5, username: '普京', password: '852369', phone: '13770366999', createTime: '2020-01-11 20:00:00'},
    { id: 6, username: '欧拉', password: '123456', phone: '13770366999', createTime: '2020-05-11 20:00:00'},
    { id: 7, username: '高斯', password: '123456', phone: '13770366999', createTime: '2020-09-11 20:00:00'},
    { id: 8, username: '詹姆斯高斯林', password: '123456', phone: '13770366999', createTime: '2020-07-11 20:00:00'},
    { id: 9, username: '图灵', password: '654321', phone: '13770366999', createTime: '2020-01-11 20:00:00'},
    { id: 10, username: '肯汤普森', password: '852369', phone: '13770366999', createTime: '2020-01-11 20:00:00'},
    { id: 11, username: '林纳斯托瓦兹', password: '123456', phone: '13770366999', createTime: '2020-05-11 20:00:00'},
    { id: 12, username: '安德斯海尔斯伯格', password: '123456', phone: '13770366999', createTime: '2020-09-11 20:00:00'},
    { id: 13, username: 'Guido Van Rossum', password: '123456', phone: '13770366999', createTime: '2020-07-11 20:00:00'},
    { id: 14, username: 'HotSpot作者', password: '654321', phone: '13770366999', createTime: '2020-01-11 20:00:00'},
  ]
  
  new Vue({
    el: '#app',
    data: {
      loading: true,
      users: [],
      pageNum: 1,
      pageSize: 5,
      total: 0,
      search: '',
      multipleSelection: [],
      dialogFormVisible: false,
      title: '',
      form: {
        username: '',
        password: '',
        phone: '',
      },
      edited: false
    },
    methods: {
      init() {
        this.total = mockUsers.length
        const start = (this.pageNum - 1) * this.pageSize
        const end = start + this.pageSize
        this.users = mockUsers.slice(start, end)
      },
      handleSizeChange(val) {
        console.log(`每页 ${val} 条`)
        this.pageSize = val
        this.init()
      },
      handleCurrentChange(val) {
        console.log(`当前页: ${val}`)
        this.pageNum = val
        this.init()
      },
      handleVisible(row) {
        console.log(row)
        this.dialogFormVisible = true
        
        if (row instanceof PointerEvent) {
          this.edited = false
          this.title = '添加用户'
          console.log("添加用户")
          return
        }
        
        this.form = row
        this.title = '修改用户'
        this.edited = true
        console.log("修改用户")
      },
      handleDelete(idList) {
        if (idList.length === 0) {
          return alert("请选中再删除!")
        }
        
        if (confirm("确认删除吗?")) {
          console.log("被删除的id列表是: ", idList)
        }
      },
      handleUpdate() {
        if (this.edited) {
          console.log("发送PUT请求修改数据!")  
        } else {
          console.log("发送POST请求添加数据!")
        }
        
        this.dialogFormVisible = false
      },
      handleSelectionChange(val) {
        this.multipleSelection = val
        console.log(this.multipleSelection)
      }
    },
    computed: {
       idList() {
         return this.multipleSelection.map(item => item.id)
       }
    },
    created() {
      setInterval(() => {
        this.init()
        this.loading = false
      }, 1500)
    }
  })
</script>
